{"is_source_file": true, "format": "JavaScript", "description": "This file implements a background notification and alarm scheduler for task reminders in a web application. It manages notification settings, handles browser visibility changes, performs periodic checks for upcoming or overdue tasks, triggers desktop notifications, plays alarm sounds, and offers methods to configure and test the notification system.", "external_files": ["./audioService"], "external_methods": ["audioService.play", "audioService.stop", "audioService.getIsPlaying"], "published": ["notificationScheduler"], "classes": [{"name": "NotificationScheduler", "description": "A class responsible for scheduling and managing task reminder notifications, handling permissions, visibility changes, and alarm sounds."}], "methods": [{"name": "constructor()", "description": "Initializes the notification scheduler, sets up visibility change listeners, and checks notification permissions.", "scope": "NotificationScheduler", "scopeKind": "class"}, {"name": "requestPermission()", "description": "Requests permission from the user to display desktop notifications.", "scope": "NotificationScheduler", "scopeKind": "class"}, {"name": "showDesktopNotification(task, isOverdue, minutesUntil)", "description": "Displays a desktop notification for a task if permissions are granted.", "scope": "NotificationScheduler", "scopeKind": "class"}, {"name": "handleVisibilityChange()", "description": "Handles changes to the document's visibility (e.g., tab focus/blur) to perform catch-up checks and adjust polling intervals.", "scope": "NotificationScheduler", "scopeKind": "class"}, {"name": "performCatchUpCheck()", "description": "Performs an immediate check for missed notifications when the page regains focus.", "scope": "NotificationScheduler", "scopeKind": "class"}, {"name": "restartScheduler()", "description": "Restarts the checking interval based on page visibility.", "scope": "NotificationScheduler", "scopeKind": "class"}, {"name": "start(tasks, onNotification)", "description": "Starts the notification scheduler with a list of tasks and a callback for notifications.", "scope": "NotificationScheduler", "scopeKind": "class"}, {"name": "stop()", "description": "Stops the notification scheduler and removes visibility change listeners.", "scope": "NotificationScheduler", "scopeKind": "class"}, {"name": "updateTasks(tasks)", "description": "Updates the list of tasks to monitor.", "scope": "NotificationScheduler", "scopeKind": "class"}, {"name": "checkTasks()", "description": "Checks all tasks to determine if notifications should be triggered based on due times and settings.", "scope": "NotificationScheduler", "scopeKind": "class"}, {"name": "triggerNotification(task, timeUntilDue, settings)", "description": "Handles the process of issuing notifications, playing sounds, and invoking callbacks for a specific task.", "scope": "NotificationScheduler", "scopeKind": "class"}, {"name": "playAlarm(loop = false)", "description": "Plays an alarm sound, optionally looping.", "scope": "NotificationScheduler", "scopeKind": "class"}, {"name": "stopAlarm()", "description": "Stops the currently playing alarm sound.", "scope": "NotificationScheduler", "scopeKind": "class"}, {"name": "isAlarmPlaying()", "description": "Returns whether an alarm sound is currently playing.", "scope": "NotificationScheduler", "scopeKind": "class"}, {"name": "getSettings()", "description": "Retrieves current notification settings.", "scope": "NotificationScheduler", "scopeKind": "class"}, {"name": "updateSettings(newSettings)", "description": "Updates and saves notification settings.", "scope": "NotificationScheduler", "scopeKind": "class"}, {"name": "getPermissionState()", "description": "Returns the current permission state for desktop notifications.", "scope": "NotificationScheduler", "scopeKind": "class"}, {"name": "shouldPromptForPermission()", "description": "Determines if the application should prompt the user for notification permission.", "scope": "NotificationScheduler", "scopeKind": "class"}, {"name": "testAlarm()", "description": "Plays a test alarm sound for 3 seconds.", "scope": "NotificationScheduler", "scopeKind": "class"}, {"name": "clearDismissedNotifications()", "description": "Clears all dismissed notification records (useful for testing).", "scope": "NotificationScheduler", "scopeKind": "class"}, {"name": "getTaskNotificationStatus(taskId)", "description": "Retrieves notification dismissal status for a specific task.", "scope": "NotificationScheduler", "scopeKind": "class"}, {"name": "getDismissedNotifications()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "getLastCheckTime()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "getNotificationSettings()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "markNotificationDismissed(taskId)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "saveLastCheckTime(time)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "saveNotificationSettings(settings)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "wasRecentlyDismissed(taskId)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["localStorage.getItem", "localStorage.setItem", "localStorage.removeItem", "JSON.parse", "JSON.stringify", "document.addEventListener", "document.removeEventListener", "window.focus", "Notification.requestPermission", "Notification.permission", "Notification", "setInterval", "clearInterval", "console.log", "console.warn", "console.error", "audioService.play", "audioService.stop", "audioService.getIsPlaying"], "search-terms": ["notificationScheduler", "task reminders", "desktop notifications", "visibilitychange", "catch-up check", "alarm sound", "Notification API", "localStorage notification settings", "background tab notifications", "play alarm", "alarm.mp3", "task due alert"], "state": 2, "file_id": 17, "knowledge_revision": 77, "git_revision": "7852cf807fe5b502b36c8cd95eea00e51a26181e", "ctags": [{"_type": "tag", "name": "DISMISSED_NOTIFICATIONS_KEY", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^const DISMISSED_NOTIFICATIONS_KEY = \"task_scheduler_dismissed_notifications\";$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "LAST_CHECK_TIME_KEY", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^const LAST_CHECK_TIME_KEY = \"task_scheduler_last_check_time\";$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "NOTIFICATION_SETTINGS_KEY", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^const NOTIFICATION_SETTINGS_KEY = \"task_scheduler_notification_settings\";$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "NotificationScheduler", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^export class NotificationScheduler {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "checkTasks", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^  checkTasks() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "NotificationScheduler", "scopeKind": "class"}, {"_type": "tag", "name": "clearDismissedNotifications", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^  clearDismissedNotifications() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "NotificationScheduler", "scopeKind": "class"}, {"_type": "tag", "name": "constructor", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^  constructor() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "NotificationScheduler", "scopeKind": "class"}, {"_type": "tag", "name": "getDismissedNotifications", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^function getDismissedNotifications() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "getLastCheckTime", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^function getLastCheckTime() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "getNotificationSettings", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^function getNotificationSettings() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "getPermissionState", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^  getPermissionState() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "NotificationScheduler", "scopeKind": "class"}, {"_type": "tag", "name": "getSettings", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^  getSettings() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "NotificationScheduler", "scopeKind": "class"}, {"_type": "tag", "name": "getTaskNotificationStatus", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^  getTaskNotificationStatus(taskId) {$/", "language": "JavaScript", "kind": "method", "signature": "(taskId)", "scope": "NotificationScheduler", "scopeKind": "class"}, {"_type": "tag", "name": "handleVisibilityChange", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^  handleVisibilityChange() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "NotificationScheduler", "scopeKind": "class"}, {"_type": "tag", "name": "isAlarmPlaying", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^  isAlarmPlaying() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "NotificationScheduler", "scopeKind": "class"}, {"_type": "tag", "name": "markNotificationDismissed", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^function markNotificationDismissed(taskId) {$/", "language": "JavaScript", "kind": "function", "signature": "(taskId)"}, {"_type": "tag", "name": "notificationScheduler", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^export const notificationScheduler = new NotificationScheduler();$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "performCatchUpCheck", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^  performCatchUpCheck() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "NotificationScheduler", "scopeKind": "class"}, {"_type": "tag", "name": "playAlarm", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^  async playAlarm(loop = false) {$/", "language": "JavaScript", "kind": "method", "signature": "(loop = false)", "scope": "NotificationScheduler", "scopeKind": "class"}, {"_type": "tag", "name": "requestPermission", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^  async requestPermission() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "NotificationScheduler", "scopeKind": "class"}, {"_type": "tag", "name": "restartScheduler", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^  restartScheduler() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "NotificationScheduler", "scopeKind": "class"}, {"_type": "tag", "name": "saveLastCheckTime", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^function saveLastCheckTime(time) {$/", "language": "JavaScript", "kind": "function", "signature": "(time)"}, {"_type": "tag", "name": "saveNotificationSettings", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^function saveNotificationSettings(settings) {$/", "language": "JavaScript", "kind": "function", "signature": "(settings)"}, {"_type": "tag", "name": "shouldPromptForPermission", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^  shouldPromptForPermission() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "NotificationScheduler", "scopeKind": "class"}, {"_type": "tag", "name": "showDesktopNotification", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^  showDesktopNotification(task, isOverdue, minutesUntil) {$/", "language": "JavaScript", "kind": "method", "signature": "(task, isOverdue, minutesUntil)", "scope": "NotificationScheduler", "scopeKind": "class"}, {"_type": "tag", "name": "start", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^  start(tasks, onNotification) {$/", "language": "JavaScript", "kind": "method", "signature": "(tasks, onNotification)", "scope": "NotificationScheduler", "scopeKind": "class"}, {"_type": "tag", "name": "stop", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^  stop() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "NotificationScheduler", "scopeKind": "class"}, {"_type": "tag", "name": "stopAlarm", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^  stopAlarm() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "NotificationScheduler", "scopeKind": "class"}, {"_type": "tag", "name": "testAlarm", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^  async testAlarm() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "NotificationScheduler", "scopeKind": "class"}, {"_type": "tag", "name": "triggerNotification", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^  async triggerNotification(task, timeUntilDue, settings) {$/", "language": "JavaScript", "kind": "method", "signature": "(task, timeUntilDue, settings)", "scope": "NotificationScheduler", "scopeKind": "class"}, {"_type": "tag", "name": "updateSettings", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^  updateSettings(newSettings) {$/", "language": "JavaScript", "kind": "method", "signature": "(newSettings)", "scope": "NotificationScheduler", "scopeKind": "class"}, {"_type": "tag", "name": "updateTasks", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^  updateTasks(tasks) {$/", "language": "JavaScript", "kind": "method", "signature": "(tasks)", "scope": "NotificationScheduler", "scopeKind": "class"}, {"_type": "tag", "name": "wasRecentlyDismissed", "path": "/home/kavia/workspace/code-generation/task-scheduler-pro-215323-215338/task_scheduler_frontend/src/services/notificationScheduler.js", "pattern": "/^function wasRecentlyDismissed(taskId) {$/", "language": "JavaScript", "kind": "function", "signature": "(taskId)"}], "hash": "53d3ae9873529e0f90ba1efb19ac5833", "format-version": 4, "code-base-name": "task_scheduler_frontend", "filename": "task_scheduler_frontend/src/services/notificationScheduler.js", "revision_history": [{"77": "7852cf807fe5b502b36c8cd95eea00e51a26181e"}]}